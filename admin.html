<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administration - Comic Con Birthday</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-xl);
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--bg-tertiary);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      text-align: center;
      border: 2px solid transparent;
      transition: var(--transition);
    }
    
    .stat-card:hover {
      border-color: var(--primary-color);
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary-color);
      display: block;
    }
    
    .reservations-table {
      background: var(--bg-tertiary);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 2rem;
    }
    
    .table-header {
      background: var(--primary-color);
      color: white;
      padding: 1rem;
      font-weight: bold;
    }
    
    .table-content {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .reservation-row {
      display: grid;
      grid-template-columns: 2fr 2fr 1fr 1fr 1fr 2fr 1fr;
      gap: 1rem;
      padding: 1rem;
      border-bottom: 1px solid var(--bg-secondary);
      align-items: center;
    }
    
    .reservation-row:hover {
      background: var(--bg-secondary);
    }
    
    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .login-form {
      max-width: 400px;
      margin: 4rem auto;
      padding: 2rem;
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      text-align: center;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Formulaire de connexion -->
    <div id="login-section" class="login-form">
      <h2>üîí Administration</h2>
      <p>Acc√®s r√©serv√© √† l'organisateur</p>
      <form id="admin-login-form">
        <input type="password" id="admin-password" placeholder="Mot de passe" required class="form-input" style="margin-bottom: 1rem;">
        <button type="submit" class="btn btn-primary btn-full">Se connecter</button>
      </form>
      <p style="margin-top: 1rem;">
        <a href="index.html" class="btn btn-secondary">‚Üê Retour au site</a>
      </p>
    </div>

    <!-- Interface d'administration -->
    <div id="admin-section" class="admin-container hidden">
      <div class="admin-header">
        <h1>üéÆ Administration Comic Con Birthday</h1>
        <p>Gestion des r√©servations et statistiques</p>
        <button onclick="logout()" class="btn btn-secondary" style="margin-top: 1rem;">üö™ D√©connexion</button>
      </div>

      <!-- Statistiques -->
      <div class="stats-grid" id="stats-grid">
        <!-- Les stats seront g√©n√©r√©es dynamiquement -->
      </div>

      <!-- Actions rapides -->
      <div class="action-buttons">
        <button onclick="refreshData()" class="btn btn-primary">üîÑ Actualiser</button>
        <button onclick="exportJSON()" class="btn btn-secondary">üì• Export JSON</button>
        <button onclick="exportCSV()" class="btn btn-secondary">üìä Export CSV</button>
        <button onclick="clearAll()" class="btn" style="background: var(--error-color);">üóëÔ∏è Vider tout</button>
      </div>

      <!-- Tableau des r√©servations -->
      <div class="reservations-table">
        <div class="table-header">
          üìã Liste des r√©servations
        </div>
        <div class="table-content" id="reservations-list">
          <!-- Les r√©servations seront g√©n√©r√©es dynamiquement -->
        </div>
      </div>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = '29Juillet'; // Changez ce mot de passe !
    
    // V√©rifier si d√©j√† connect√©
    document.addEventListener('DOMContentLoaded', function() {
      if (isLoggedIn()) {
        showAdminSection();
      }
    });

    // Gestion de la connexion
    document.getElementById('admin-login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const password = document.getElementById('admin-password').value;
      
      if (password === ADMIN_PASSWORD) {
        localStorage.setItem('admin_session', JSON.stringify({
          timestamp: Date.now(),
          authenticated: true
        }));
        showAdminSection();
      } else {
        alert('‚ùå Mot de passe incorrect');
      }
    });

    function isLoggedIn() {
      const session = localStorage.getItem('admin_session');
      if (session) {
        const sessionData = JSON.parse(session);
        const sessionDuration = 30 * 60 * 1000; // 30 minutes
        return Date.now() - sessionData.timestamp < sessionDuration;
      }
      return false;
    }

    function showAdminSection() {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('admin-section').classList.remove('hidden');
      loadReservations();
    }

    function logout() {
      localStorage.removeItem('admin_session');
      document.getElementById('admin-section').classList.add('hidden');
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('admin-password').value = '';
    }

    function loadReservations() {
      const reservations = JSON.parse(localStorage.getItem('reservations') || '{"reservations": []}');
      
      // G√©n√©rer les statistiques
      generateStats(reservations.reservations);
      
      // G√©n√©rer la liste des r√©servations
      generateReservationsList(reservations.reservations);
    }

    function generateStats(reservations) {
      const totalReservations = reservations.length;
      const totalPersonnes = reservations.reduce((total, res) => total + res.adultes + res.enfants, 0);
      const totalAdultes = reservations.reduce((total, res) => total + res.adultes, 0);
      const totalEnfants = reservations.reduce((total, res) => total + res.enfants, 0);
      
      const statsGrid = document.getElementById('stats-grid');
      statsGrid.innerHTML = `
        <div class="stat-card">
          <span class="stat-number">${totalReservations}</span>
          <div>R√©servations</div>
        </div>
        <div class="stat-card">
          <span class="stat-number">${totalPersonnes}</span>
          <div>Total Personnes</div>
        </div>
        <div class="stat-card">
          <span class="stat-number">${totalAdultes}</span>
          <div>Adultes</div>
        </div>
        <div class="stat-card">
          <span class="stat-number">${totalEnfants}</span>
          <div>Enfants</div>
        </div>
      `;
    }

    function generateReservationsList(reservations) {
      const listContainer = document.getElementById('reservations-list');
      
      if (reservations.length === 0) {
        listContainer.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-muted);">Aucune r√©servation pour le moment</div>';
        return;
      }

      let html = `
        <div class="reservation-row" style="background: var(--primary-color); color: white; font-weight: bold;">
          <div>Nom</div>
          <div>Email</div>
          <div>Adultes</div>
          <div>Enfants</div>
          <div>Total</div>
          <div>Date</div>
          <div>Actions</div>
        </div>
      `;

      reservations.forEach((res, index) => {
        html += `
          <div class="reservation-row">
            <div>${res.nom}</div>
            <div>${res.email}</div>
            <div style="text-align: center;">${res.adultes}</div>
            <div style="text-align: center;">${res.enfants}</div>
            <div style="text-align: center; font-weight: bold;">${res.adultes + res.enfants}</div>
            <div style="font-size: 0.8rem;">${res.date}</div>
            <div style="text-align: center;">
              <button onclick="deleteReservation(${index})" class="btn" style="background: var(--error-color); padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      });

      listContainer.innerHTML = html;
    }

    function deleteReservation(index) {
      const reservations = JSON.parse(localStorage.getItem('reservations') || '{"reservations": []}');
      const reservation = reservations.reservations[index];
      
      if (confirm(`Supprimer la r√©servation de ${reservation.nom} ?`)) {
        reservations.reservations.splice(index, 1);
        localStorage.setItem('reservations', JSON.stringify(reservations));
        loadReservations(); // Actualiser l'affichage
        alert('R√©servation supprim√©e');
      }
    }

    function refreshData() {
      loadReservations();
      alert('‚úÖ Donn√©es actualis√©es');
    }

    function exportJSON() {
      const reservations = JSON.parse(localStorage.getItem('reservations') || '{"reservations": []}');
      const dataStr = JSON.stringify(reservations, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(dataBlob);
      downloadLink.download = `reservations_${new Date().toISOString().split('T')[0]}.json`;
      downloadLink.click();
    }

    function exportCSV() {
      const reservations = JSON.parse(localStorage.getItem('reservations') || '{"reservations": []}');
      
      if (reservations.reservations.length === 0) {
        alert('Aucune r√©servation √† exporter');
        return;
      }
      
      let csvContent = 'Nom,Email,Adultes,Enfants,Total,Message,Date\n';
      
      reservations.reservations.forEach(res => {
        const message = (res.message || '').replace(/"/g, '""');
        csvContent += `"${res.nom}","${res.email}",${res.adultes},${res.enfants},${res.adultes + res.enfants},"${message}","${res.date}"\n`;
      });
      
      const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(csvBlob);
      downloadLink.download = `reservations_${new Date().toISOString().split('T')[0]}.csv`;
      downloadLink.click();
    }

    function clearAll() {
      if (confirm('‚ö†Ô∏è ATTENTION : Supprimer TOUTES les r√©servations ?\n\nCette action est irr√©versible !')) {
        if (confirm('√ätes-vous vraiment s√ªr ? Toutes les donn√©es seront perdues.')) {
          localStorage.removeItem('reservations');
          loadReservations();
          alert('üóëÔ∏è Toutes les r√©servations ont √©t√© supprim√©es');
        }
      }
    }
  </script>
</body>
</html>